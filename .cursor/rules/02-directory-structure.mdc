---
description: Štruktúra projektu a umiestnenie súborov v Magnum Opus v2.0
globs: ["**/*"]
alwaysApply: true
---

# Directory Structure

Toto pravidlo definuje štruktúru projektu a umiestnenie súborov v Magnum Opus v2.0 (3-layer architektúra).

## Hlavná Štruktúra

```
xvadur-workspace/
├── development/                  # Development layer - aktívna práca
│   ├── data/                     # Dáta
│   │   ├── prompts_log.jsonl     # Prompt log (JSONL)
│   │   ├── conversations.jsonl   # Konverzačné páry
│   │   ├── profile/              # Profily a identity maps
│   │   │   └── xvadur_profile.md
│   │   └── xp_history.jsonl      # História XP
│   ├── logs/                     # Logy
│   │   ├── XVADUR_LOG.md         # Chronologický log práce
│   │   └── XVADUR_XP.md          # XP tracking
│   └── sessions/                 # Session management
│       ├── current/              # Aktuálna session
│       ├── archive/              # Archívované sessiony
│       └── save_games/           # Save game súbory
│           ├── SAVE_GAME_LATEST.md
│           └── SAVE_GAME_LATEST_SUMMARY.md
│
├── staging/                      # Staging layer - denný review
│   ├── review/                   # Denné review dokumenty
│   └── sessions/                 # Session management pre staging
│       ├── today/
│       └── yesterday/
│
├── production/                   # Production layer - automatizácie
│   ├── metrics/                  # Automatizované metriky
│   │   ├── daily/
│   │   └── weekly/
│   └── sessions/                 # Session management pre production
│       └── archive/
│
├── core/                         # Jadro systému (Python package)
│   ├── ministers/                # Ministerial layer (Memory)
│   │   ├── __init__.py
│   │   ├── memory.py             # MinisterOfMemory systém
│   │   └── storage.py            # FileStore implementácia
│   ├── rag/                      # RAG systém
│   │   ├── __init__.py
│   │   ├── build_rag_index.py    # Vytvorenie FAISS indexu
│   │   └── rag_agent_helper.py   # RAG helper funkcie
│   └── xp/                       # XP systém
│       ├── __init__.py
│       ├── calculator.py         # XP výpočet
│       └── levels.json           # Level definície
│
├── data/                         # Globálne dáta (RAG index)
│   └── rag_index/                # FAISS index a metadata
│
├── scripts/                      # Workspace skripty
│   ├── auto_save_prompt.py       # Automatické ukladanie promptov
│   ├── save_conversation_prompts.py  # Batch ukladanie pri savegame
│   ├── calculate_daily_metrics.py    # Denné metriky
│   ├── auto_archive_session.py       # Automatická archivácia session
│   ├── create_new_session.py         # Vytvorenie novej session
│   ├── generate_daily_review.py      # Denný review
│   ├── analysis/                 # Analýza skripty
│   ├── rag/                      # RAG skripty (legacy)
│   ├── synthesis/                # Syntéza skripty
│   └── utils/                    # Utility skripty
│
├── docs/                         # Dokumentácia
│   ├── ARCHITECTURE.md           # Architektúra systému
│   ├── MEMORY_SYSTEM.md          # MinisterOfMemory systém
│   ├── SESSION_MANAGEMENT.md     # Session management
│   ├── MCP_INTEGRATION.md        # MCP integrácia
│   └── README.md                 # Hlavný rozcestník
│
├── templates/                    # Templates
│   └── session_template.md       # Template pre novú session
│
├── archive/                      # Archív pilotného stavu (v1.0)
│   └── pilot-v1.0/
│
├── .cursor/                      # Cursor konfigurácia
│   ├── commands/                 # Custom commands
│   │   ├── loadgame.md
│   │   ├── savegame.md
│   │   └── xvadur.md
│   └── rules/                    # Cursor Rules (tento adresár)
│
├── .cursorrules                  # Globálny systémový prompt
├── .gitignore
└── requirements.txt              # Python dependencies
```

## Pravidlá Umiestnenia

### Development Layer (`development/`)
- **Data:** `data/` - všetky dátové súbory
  - `prompts_log.jsonl` - prompt log (JSONL, lokálne, nie v git)
  - `conversations.jsonl` - konverzačné páry
  - `profile/` - profily a identity maps
  - `xp_history.jsonl` - história XP
- **Logs:** `logs/` - chronologické logy
  - `XVADUR_LOG.md` - log práce
  - `XVADUR_XP.md` - XP tracking
- **Sessions:** `sessions/` - session management
  - `current/` - aktuálna session
  - `archive/` - archívované sessiony
  - `save_games/` - save game súbory

### Staging Layer (`staging/`)
- **Review:** `review/` - denné review dokumenty
- **Sessions:** `sessions/` - session management pre staging
  - `today/` - dnešná session
  - `yesterday/` - včerajšia session (na review)

### Production Layer (`production/`)
- **Metrics:** `metrics/` - automatizované metriky
  - `daily/` - denné metriky
  - `weekly/` - týždenné metriky
- **Sessions:** `sessions/archive/` - archív pre production

### Core Layer (`core/`)
- **Ministers:** `ministers/` - Python package pre memory management
  - `memory.py` - MinisterOfMemory, AssistantOfMemory, MemoryRecord
  - `storage.py` - FileStore implementácia (JSONL persistent storage)
- **RAG:** `rag/` - RAG systém
  - `build_rag_index.py` - vytvorenie FAISS indexu
  - `rag_agent_helper.py` - RAG helper funkcie
- **XP:** `xp/` - XP systém
  - `calculator.py` - XP výpočet
  - `levels.json` - level definície

### Workspace Scripts (`scripts/`)
- **Auto Save:** `auto_save_prompt.py` - manuálne ukladanie promptov
- **Save Game:** `utils/save_conversation_prompts.py` - batch ukladanie pri savegame
- **Metrics:** `calculate_daily_metrics.py` - denné metriky
- **Session Management:** `auto_archive_session.py`, `create_new_session.py`, `generate_daily_review.py`
- **Analysis:** `analysis/` - analýza skripty
- **Utils:** `utils/` - utility skripty

### Cursor Konfigurácia (`.cursor/`)
- **Commands:** `commands/` - custom commands
  - `loadgame.md` - načítanie kontextu z save game
  - `savegame.md` - uloženie aktuálneho stavu (s automatickým git push)
  - `xvadur.md` - xvadur konverzačný režim
- **Rules:** `rules/` - Cursor Rules (`.mdc` súbory)

### MCP Docker Systém
- **Dostupné služby:** Obsidian MCP (13), GitHub MCP (50+), Browser MCP (13), Fetch MCP, Sequential Thinking MCP, Time MCP
- **Použitie:** Merge PR, automatizácia git workflow, rapid prototyping
- **Význam:** "Ľahko operabilný MCP do ktorého môžem pohodlne pridávať ďalšie funkcie"

## Dôležité
- **Nekrižovať hranice:** Frontend kód nepatrí do backendu a naopak
- **Respektovať štruktúru:** Nové súbory musia byť v správnych adresároch
- **Konzistentnosť:** Používať rovnakú štruktúru naprieč projektom
- **3-Layer Architektúra:** Development (práca) → Staging (review) → Production (automatizácia)

## Nové Komponenty (2025-12-04)

### Automatické Ukladanie Promptov
- **Súbor:** `development/data/prompts_log.jsonl` (lokálne, nie v git)
- **Systém:** `scripts/auto_save_prompt.py` + `core/ministers/` + `FileStore`
- **Workflow:** Prompty sa ukladajú pri `/savegame` commande (savegame-only prístup)
- **Formát:** JSONL (jeden JSON objekt na riadok)

### MinisterOfMemory Systém
- **Package:** `core/ministers/` - Python package pre memory management
- **Komponenty:**
  - `MemoryRecord` - dátový model pre memory jednotky
  - `MemoryStore` - protocol pre pluggable storage
  - `InMemoryStore` - volatilné úložisko (RAM)
  - `FileStore` - persistentné úložisko (JSONL)
  - `AssistantOfMemory` - taktické memory operácie
  - `MinisterOfMemory` - orchestrácia memory stratégie

### Identity Map
- **Súbor:** `development/data/profile/xvadur_profile.md`
- **Obsah:** Kompletná mapa identity od "nesebavedomého poskoka" k "AI developerovi"
- **Sekcie:** Koreňový systém, Výcvikové tábory, Transformačné momenty, Súčasný profil

### Session Dokumenty
- **Umiestnenie:** `development/sessions/`
- **Aktuálna:** `development/sessions/current/session.md`
- **Archív:** `development/sessions/archive/`
- **Formát:** `{Deň}_{YYYY-MM-DD}.md` (napr. `Stvrtok_2025-12-04.md`)
- **Obsah:** Denné session dokumenty s poznámkami, úlohami, metrikami

### Save Game Systém
- **Umiestnenie:** `development/sessions/save_games/`
- **Súbory:** 
  - `SAVE_GAME_LATEST.md` - kompletný save game
  - `SAVE_GAME_LATEST_SUMMARY.md` - kompaktný summary (~50-70 riadkov)
- **Obsah:** Naratívny kontext, questy, status, inštrukcie pre nového agenta
- **Git:** Automatický commit a push po vytvorení save game
